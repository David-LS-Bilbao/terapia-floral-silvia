
---
import Logo from "./Logo.astro";

// Evita falsos positivos de TS en VS Code con import.meta.env
const base = (import.meta as any).env?.BASE_URL || "/";

// Normaliza con barra final para comparar correctamente
// @ts-ignore
const normalize = (p: string) => (p.endsWith("/") ? p : p + "/");

// Ruta actual (incluye el base en GitHub Pages)
// @ts-ignore
const here = normalize(Astro.url.pathname);

// Links del sitio (añade/quita según tus páginas)
const links = [
  { href: normalize(`${base}hero-b/`),         label: "Inicio" },
  { href: normalize(`${base}servicios/`),      label: "Servicios" },
  { href: normalize(`${base}contacto/`),       label: "Contacto" },
  // { href: normalize(`${base}flores/`),      label: "Flores de Bach" }, // cuando la habilites
];

// Helper para aplicar estilos de enlace activo
const isActive = (href: string) => here === href;
---
<header class="bg-[#FFF7F1]/80 backdrop-blur supports-[backdrop-filter]:bg-[#FFF7F1]/60 border-b border-slate-200">
  <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
   
    <!-- Logo / Marca -->
    <a href={`${base}hero-b/`} class="flex items-center gap-3 font-semibold text-slate-800" aria-label="Ir al inicio">
      <Logo size="small" priority={true} />
      <span class="hidden sm:inline">Terapias Naturales - Silvia Adame</span>
      <span class="sm:hidden">Silvia Adame</span>
    </a>

    <!-- Navegación Desktop -->
    <nav class="hidden md:flex items-center gap-5 text-sm" aria-label="Principal">
      {/* @ts-ignore */}
      {links.map((l) => (
        <a
          href={l.href}
          class={`px-1 py-2 transition-colors hover:underline ${
            isActive(l.href) ? "text-slate-900 font-semibold underline" : "text-slate-700"
          }`}
          aria-current={isActive(l.href) ? "page" : undefined}
        >
          {l.label}
        </a>
      ))}
    </nav>

    <!-- Botón hamburguesa móvil -->
    <button 
      id="mobile-menu-button"
      class="md:hidden flex flex-col items-center justify-center w-8 h-8 space-y-1"
      aria-label="Abrir menú de navegación"
      aria-expanded="false"
    >
      <span class="mobile-menu-line w-6 h-0.5 bg-slate-700 transition-all duration-300"></span>
      <span class="mobile-menu-line w-6 h-0.5 bg-slate-700 transition-all duration-300"></span>
      <span class="mobile-menu-line w-6 h-0.5 bg-slate-700 transition-all duration-300"></span>
    </button>
  </div>

  <!-- Menú móvil overlay -->
  <div 
    id="mobile-menu-overlay"
    class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 opacity-0 invisible transition-all duration-300 md:hidden"
  >
    <nav 
      class="absolute top-0 right-0 h-full w-72 bg-white/95 backdrop-blur-md shadow-2xl border-l border-slate-200 transform translate-x-full transition-transform duration-300"
      aria-label="Navegación móvil"
    >
      <!-- Header del menú móvil -->
      <div class="bg-gradient-to-r from-[#3B755F] to-[#9FB8AD] px-6 py-5 text-white">
        <h2 class="text-lg font-semibold">Navegación</h2>
        <p class="text-sm opacity-90">Terapias Naturales</p>
      </div>
      
      <div class="p-6">
        {/* @ts-ignore */}
        {links.map((l) => (
          <a
            href={l.href}
            class={`block py-4 px-5 mb-3 rounded-xl text-lg font-medium transition-all duration-200 ${
              isActive(l.href) 
                ? "bg-[#3B755F] text-white shadow-lg scale-105" 
                : "text-slate-800 hover:bg-[#9FB8AD]/20 hover:text-[#3B755F] hover:scale-102"
            }`}
            aria-current={isActive(l.href) ? "page" : undefined}
          >
            {l.label}
          </a>
        ))}
      </div>
    </nav>
  </div>
</header>

<script is:inline>
  // Menú móvil interactivo
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const menuOverlay = document.getElementById('mobile-menu-overlay');
    const menuNav = menuOverlay?.querySelector('nav');
    const menuLines = document.querySelectorAll('.mobile-menu-line');
    
    // Si no encontramos los elementos, salir
    if (!menuButton || !menuOverlay || !menuNav) {
      console.warn('Mobile menu elements not found');
      return;
    }
    
    let isOpen = false;

    function toggleMenu() {
      isOpen = !isOpen;
      
      if (isOpen) {
        // Abrir menú
        menuOverlay?.classList.remove('opacity-0', 'invisible');
        menuNav?.classList.remove('translate-x-full');
        menuButton?.setAttribute('aria-expanded', 'true');
        
        // Animar hamburguesa a X
        if (menuLines[0]) menuLines[0].style.transform = 'rotate(45deg) translate(6px, 6px)';
        if (menuLines[1]) menuLines[1].style.opacity = '0';
        if (menuLines[2]) menuLines[2].style.transform = 'rotate(-45deg) translate(6px, -6px)';
        
        // Bloquear scroll del body
        document.body.style.overflow = 'hidden';
      } else {
        // Cerrar menú
        menuOverlay?.classList.add('opacity-0', 'invisible');
        menuNav?.classList.add('translate-x-full');
        menuButton?.setAttribute('aria-expanded', 'false');
        
        // Restaurar hamburguesa
        menuLines.forEach(line => {
          line.style.transform = '';
          line.style.opacity = '';
        });
        
        // Restaurar scroll del body
        document.body.style.overflow = '';
      }
    }

    // Event listeners
    menuButton?.addEventListener('click', toggleMenu);
    
    // Cerrar al hacer clic en el overlay
    menuOverlay?.addEventListener('click', function(e) {
      if (e.target === menuOverlay) {
        toggleMenu();
      }
    });
    
    // Cerrar al hacer clic en un enlace
    menuOverlay?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', function() {
        toggleMenu();
      });
    });
    
    // Cerrar con tecla Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && isOpen) {
        toggleMenu();
      }
    });
  }

  // Inicializar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }
</script>







